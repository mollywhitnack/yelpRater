"use strict";var app=angular.module("myApp",["ui.router","satellizer","ngFileUpload"]);app.config(["$authProvider",function(e){e.loginUrl="api/users/login",e.signupUrl="api/users/signup",e.facebook({clientId:"255060128209165",url:"/api/users/facebook"})}]),app.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/",templateUrl:"/html/home.html"}).state("login",{url:"/login",templateUrl:"/html/login.html",controller:"loginCtrl"}).state("register",{url:"/register",templateUrl:"/html/register.html",controller:"registerCtrl"}).state("profile",{url:"/profile/:userId",templateUrl:"/html/profile.html",controller:"profileCtrl",resolve:{Profile:["User",function(e){return e.profile()}],ProfileByID:["User","$stateParams",function(e,o){return e.getProfile(o.userId)}]}}).state("users",{url:"/users",templateUrl:"/html/users.html",controller:"usersCtrl"}).state("business",{url:"/business",templateUrl:"/html/business.html",controller:"businessCtrl",resolve:{Profile:["User",function(e){return e.profile()}]}}).state("showBusiness",{url:"/business/:businessId",templateUrl:"html/showbusiness.html",controller:"showbusinessCtrl"}),o.otherwise("/")}]);var app=angular.module("myApp");app.controller("businessCtrl",["$scope","$rootScope","Business","Profile","User",function(e,o,t,n,r){console.log("businessCtrl"),e.businesses=[],e.searchBusiness=function(){console.log("$scope.newItem.searchParams",e.newItem.searchParams),t.searchYelp(e.newItem.searchParams).then(function(o){console.log("res:",o),e.businesses.push(o)})["catch"](function(e){console.log("err in businessCtrl: ",e)})},e.favorite=function(o){e.toggleFave=!e.toggleFave,console.log("$scope.businesses[index]:",e.businesses[o].id),t.addFavorite(e.businesses[o],n._id).then(function(t){console.log("res:",t),r.addFavoritetoUser(e.businesses[o],n._id)})["catch"](function(e){console.log("err in businessCtrl: ",e)})}}]);var app=angular.module("myApp");app.controller("imageCtrl",["$scope","Upload","Profile","$rootScope",function(e,o,t,n){console.log("image ctrl"),n.currentUser=t,e.submit=function(){console.log("submit"),console.log("$scope.file:",e.file),o.upload({url:"/api/images",data:{photo:e.file,user:n.currentUser._id}}).then(function(o){console.log("res: ",o),e.savedImage=o.data})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("loginCtrl",["$scope","$state","$auth","$rootScope",function(e,o,t,n){console.log("loginCtrl!"),e.login=function(){t.login(e.user).then(function(e){console.log("res: ",e),o.go("profile")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("mainCtrl",["$scope","$state","$auth","$rootScope",function(e,o,t,n){console.log("mainCtrl!"),n.currentUser,e.isAuthenticated=function(){return t.isAuthenticated()},e.logout=function(){t.logout(),o.go("home")},e.authenticate=function(e){t.authenticate(e).then(function(e){o.go("home")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("profileCtrl",["$scope","Profile","ProfileByID","$state","User","$rootScope","WallPost",function(e,o,t,n,r,s,l){console.log("profileCtrl!"),s.currentUser=o,e.user=t||o,l.getWallPosts(e.user._id).then(function(o){e.userWallposts=o}),console.log("user:",e.user),console.log("curruser:",s.currentUser),e.showdisplayNameForm=function(){console.log("show form"),e.displayNameForm=!0},e.updatedisplayName=function(){e.displayNameForm=!1,e.user.displayName=e.newItem.displayName,r.updateProfile(e.user._id,e.newItem).then(function(o){console.log("profile:",o),e.newItem.displayName=""})["catch"](function(e){console.log("err:",e)})},e.canceldisplayName=function(){e.usernameForm=!0,e.newItem.displayName=""},e.showPictureForm=function(){console.log("show form"),e.photoForm=!0},e.updatePicture=function(){e.photoForm=!1,console.log("$state.current: ",n.current),e.user.profileImage=e.newItem.profileImage,console.log("$scope.newItem:",e.newItem),r.updateProfile(e.user._id,e.newItem).then(function(o){console.log("profile:",o),e.newItem.profileImage=""})["catch"](function(e){console.log("err:",e)})},e.cancelPhotoUrl=function(){e.photoForm=!0,e.newItem.photoUrl=""},e.deleteAccount=function(e){console.log(e._id),r.deleteAccount(e._id).then()["catch"](function(e){console.log("err: ",e)})},e.submitMessage=function(){var o={to:e.user,from:s.currentUser._id,fromName:s.currentUser.displayName,text:e.newItem.text,createdAt:"add moment"};console.log("post obj:",o),l.addWallPost(o).then(function(e){console.log("wallpost:",e),r.addWallPostToUser(t._id,e._id)}).then(n.go(n.$current,null,{reload:!0}))["catch"](function(e){console.log("err: ",e)})}}]);var app=angular.module("myApp");app.controller("registerCtrl",["$scope","$state","$auth",function(e,o,t){console.log("registerCtrl!"),e.register=function(){e.user.password!==e.user.password2?(e.user.password=null,e.user.password2=null,alert("Passwords must match!")):t.signup(e.user).then(function(e){console.log("res: ",e),o.go("login")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("showbusinessCtrl",["$scope","$stateParams","Business",function(e,o,t){console.log("showbusinessCtrl!");var n=o;console.log("businessId",n.businessId),t.searchYelp(n.businessId).then(function(o){console.log("res:",o),e.business=o})["catch"](function(e){console.log("err in businessCtrl: ",e)})}]);var app=angular.module("myApp");app.controller("usersCtrl",["$scope","$$state","$state","User",function(e,o,t,n){console.log("usersCtrl!");var r=n.getAll();console.log("userPromise:",r),r.then(function(o){console.log(o.data),e.userFeed=o.data})}]);var app=angular.module("myApp");app.service("Business",["$http","$q",function(e,o){this.searchYelp=function(t){return console.log("search: ",t),e.get("/api/businesses/yelp/"+t).then(function(e){return console.log("res.data in services:",e.data),console.log("res in services:",e),o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.addFavorite=function(t,n){return console.log("businessObj:",t),e.post("/api/businesses/"+n,t).then(function(e){return console.log("res ln 24 business services:",e),o.resolve(e)})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("image",["$http","$q",function(e,o){this.getAll=function(){return e.get("/api/cruds")},this.getById=function(o){return e.get("/api/cruds/"+o)},this.addCrud=function(t){return e.post("/api/cruds",t).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.deleteCrud=function(t){return e["delete"]("/api/cruds/"+t).then(function(){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.updateCrud=function(t,n){return e.put("/api/cruds/"+t,n).then(function(e){return o.resolve(n)})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("User",["$http","$q",function(e,o){this.profile=function(){return e.get("/api/users/profile").then(function(e){return o.resolve(e.data)})},this.getProfile=function(t){return e.get("/api/users/profile/"+t).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.getAll=function(){return e.get("/api/users")},this.updateProfile=function(t,n){return console.log("here"),console.log(t," ",n),e.put("/api/users/profile/"+t,n).then(function(e){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.deleteAccount=function(t){return e["delete"]("/api/users/profile/"+t).then(function(e){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.addFavoriteToUser=function(t,n){return console.log("addFavoriteToUser","id:",t,"yelpId",n),e.put("/api/users/profile/"+t+"/"+n).then(function(e){return console.log("res ln 53:",e),o.resolve()})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("WallPost",["$http","$q",function(e,o){this.addWallPost=function(t){return console.log("in add wallpost: ",t),e.post("/api/wallposts",t).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.getWallPosts=function(t){return e.get("/api/wallposts/"+t).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err: ",e)})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2J1c2luZXNzQ3RybC5qcyIsImNvbnRyb2xsZXJzL2ltYWdlQ3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ3RybC5qcyIsImNvbnRyb2xsZXJzL21haW5DdHJsLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUN0cmwuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckN0cmwuanMiLCJjb250cm9sbGVycy9zaG93YnVzaW5lc3NDdHJsLmpzIiwiY29udHJvbGxlcnMvdXNlcnNDdHJsLmpzIiwic2VydmljZXMvYnVzaW5lc3NzZXJ2aWNlcy5qcyIsInNlcnZpY2VzL2ltYWdlc2VydmljZXMuanMiLCJzZXJ2aWNlcy91c2Vyc2VydmljZXMuanMiLCJzZXJ2aWNlcy93YWxscG9zdHNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkYXV0aFByb3ZpZGVyIiwibG9naW5VcmwiLCJzaWdudXBVcmwiLCJmYWNlYm9vayIsImNsaWVudElkIiwidXJsIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInJlc29sdmUiLCJQcm9maWxlIiwiVXNlciIsInByb2ZpbGUiLCJQcm9maWxlQnlJRCIsIiRzdGF0ZVBhcmFtcyIsImdldFByb2ZpbGUiLCJ1c2VySWQiLCJvdGhlcndpc2UiLCIkc2NvcGUiLCIkcm9vdFNjb3BlIiwiQnVzaW5lc3MiLCJjb25zb2xlIiwibG9nIiwiYnVzaW5lc3NlcyIsInNlYXJjaEJ1c2luZXNzIiwibmV3SXRlbSIsInNlYXJjaFBhcmFtcyIsInNlYXJjaFllbHAiLCJ0aGVuIiwicmVzIiwicHVzaCIsImVyciIsImZhdm9yaXRlIiwiaW5kZXgiLCJ0b2dnbGVGYXZlIiwiaWQiLCJhZGRGYXZvcml0ZSIsIl9pZCIsImFkZEZhdm9yaXRldG9Vc2VyIiwiVXBsb2FkIiwiY3VycmVudFVzZXIiLCJzdWJtaXQiLCJmaWxlIiwidXBsb2FkIiwiZGF0YSIsInBob3RvIiwidXNlciIsInNhdmVkSW1hZ2UiLCIkc3RhdGUiLCIkYXV0aCIsImxvZ2luIiwiZ28iLCJpc0F1dGhlbnRpY2F0ZWQiLCJsb2dvdXQiLCJhdXRoZW50aWNhdGUiLCJwcm92aWRlciIsIldhbGxQb3N0IiwiZ2V0V2FsbFBvc3RzIiwidXNlcldhbGxwb3N0cyIsInNob3dkaXNwbGF5TmFtZUZvcm0iLCJkaXNwbGF5TmFtZUZvcm0iLCJ1cGRhdGVkaXNwbGF5TmFtZSIsImRpc3BsYXlOYW1lIiwidXBkYXRlUHJvZmlsZSIsImNhbmNlbGRpc3BsYXlOYW1lIiwidXNlcm5hbWVGb3JtIiwic2hvd1BpY3R1cmVGb3JtIiwicGhvdG9Gb3JtIiwidXBkYXRlUGljdHVyZSIsImN1cnJlbnQiLCJwcm9maWxlSW1hZ2UiLCJjYW5jZWxQaG90b1VybCIsInBob3RvVXJsIiwiZGVsZXRlQWNjb3VudCIsInN1Ym1pdE1lc3NhZ2UiLCJwb3N0T2JqIiwidG8iLCJmcm9tIiwiZnJvbU5hbWUiLCJ0ZXh0IiwiY3JlYXRlZEF0IiwiYWRkV2FsbFBvc3QiLCJ3YWxscG9zdCIsImFkZFdhbGxQb3N0VG9Vc2VyIiwiJGN1cnJlbnQiLCJyZWxvYWQiLCJyZWdpc3RlciIsInBhc3N3b3JkIiwicGFzc3dvcmQyIiwiYWxlcnQiLCJzaWdudXAiLCJidXNpbmVzc0lkIiwiYnVzaW5lc3MiLCIkJHN0YXRlIiwidXNlclByb21pc2UiLCJnZXRBbGwiLCJyZXN1bHQiLCJ1c2VyRmVlZCIsInNlcnZpY2UiLCIkaHR0cCIsIiRxIiwidGhpcyIsInNlYXJjaCIsImdldCIsImJ1c2luZXNzT2JqIiwicG9zdCIsImdldEJ5SWQiLCJhZGRDcnVkIiwiY3J1ZCIsImRlbGV0ZUNydWQiLCJ1cGRhdGVDcnVkIiwicHV0IiwicHJvZmlsZU9iaiIsImFkZEZhdm9yaXRlVG9Vc2VyIiwieWVscElkIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBLElBQUlBLEtBQU1DLFFB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RixHQUFNSSxJQUFOLGtCQUE0QnZGLEdBQ2hDWSxLQUFLLFNBQUFDLEdBQ0osTUFBT3VFLEdBQUczRixRQUFRb0IsRUFBSWUsUUFGbkJ1RCxTQUlFLFNBQUFwRSxHQUNMVixRQUFRQyxJQUFJLFFBQVNTIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcsIFsndWkucm91dGVyJywgJ3NhdGVsbGl6ZXInLCAnbmdGaWxlVXBsb2FkJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRhdXRoUHJvdmlkZXIpIHtcblxuICAkYXV0aFByb3ZpZGVyLmxvZ2luVXJsID0gJ2FwaS91c2Vycy9sb2dpbic7XG4gICRhdXRoUHJvdmlkZXIuc2lnbnVwVXJsID0gJ2FwaS91c2Vycy9zaWdudXAnO1xuXG4gICRhdXRoUHJvdmlkZXIuZmFjZWJvb2soe1xuICAgIGNsaWVudElkOiAnMjU1MDYwMTI4MjA5MTY1JyxcbiAgICB1cmw6ICcvYXBpL3VzZXJzL2ZhY2Vib29rJ1xuICB9KTtcblxufSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdob21lJywgeyB1cmw6ICcvJywgdGVtcGxhdGVVcmw6ICcvaHRtbC9ob21lLmh0bWwnIH0pXG4gICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2xvZ2luLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ3RybCdcbiAgICB9KVxuICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XG4gICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckN0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XG4gICAgICB1cmw6ICcvcHJvZmlsZS86dXNlcklkJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHJvZmlsZS5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIFByb2ZpbGU6IGZ1bmN0aW9uKFVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gVXNlci5wcm9maWxlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIFByb2ZpbGVCeUlEOiBmdW5jdGlvbihVc2VyLCAkc3RhdGVQYXJhbXMpe1xuICAgICAgICAgIHJldHVybiBVc2VyLmdldFByb2ZpbGUoJHN0YXRlUGFyYW1zLnVzZXJJZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgndXNlcnMnLCB7XG4gICAgICB1cmw6ICcvdXNlcnMnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC91c2Vycy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICd1c2Vyc0N0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ2J1c2luZXNzJywge1xuICAgICAgdXJsOiAnL2J1c2luZXNzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvYnVzaW5lc3MuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDdHJsJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgUHJvZmlsZTogZnVuY3Rpb24oVXNlcikge1xuICAgICAgICAgIHJldHVybiBVc2VyLnByb2ZpbGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdzaG93QnVzaW5lc3MnLCB7XG4gICAgICB1cmw6ICcvYnVzaW5lc3MvOmJ1c2luZXNzSWQnLCBcbiAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9zaG93YnVzaW5lc3MuaHRtbCcsIFxuICAgICAgY29udHJvbGxlcjogJ3Nob3didXNpbmVzc0N0cmwnXG4gICAgICB9KVxuICAgIFxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KTtcblxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdidXNpbmVzc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsIEJ1c2luZXNzLCBQcm9maWxlLCBVc2VyKXtcbiAgY29uc29sZS5sb2coXCJidXNpbmVzc0N0cmxcIik7XG5cbiAgJHNjb3BlLmJ1c2luZXNzZXMgPSBbXTtcblxuICAkc2NvcGUuc2VhcmNoQnVzaW5lc3MgPSAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIiRzY29wZS5uZXdJdGVtLnNlYXJjaFBhcmFtc1wiICwgJHNjb3BlLm5ld0l0ZW0uc2VhcmNoUGFyYW1zKVxuICAgICAgQnVzaW5lc3Muc2VhcmNoWWVscCgkc2NvcGUubmV3SXRlbS5zZWFyY2hQYXJhbXMpXG4gICAgICAudGhlbihyZXMgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVzOlwiICwgcmVzKTtcbiAgICAgICAgJHNjb3BlLmJ1c2luZXNzZXMucHVzaChyZXMpO1xuICAgICAgfSkgICAgXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVyciBpbiBidXNpbmVzc0N0cmw6IFwiLCBlcnIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICAvL2FkZCB0byB1c2VyIGZhdm9yaXRlc1xuICAgICRzY29wZS5mYXZvcml0ZSA9IChpbmRleCk9PntcbiAgICAgICRzY29wZS50b2dnbGVGYXZlID0gISRzY29wZS50b2dnbGVGYXZlO1xuICAgICAgY29uc29sZS5sb2coXCIkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF06XCIsICRzY29wZS5idXNpbmVzc2VzW2luZGV4XS5pZCk7XG4gICAgICBCdXNpbmVzcy5hZGRGYXZvcml0ZSgkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF0sIFByb2ZpbGUuX2lkKSAgICAgIFxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlczpcIiAsIHJlcyk7XG4gICAgICAgIFVzZXIuYWRkRmF2b3JpdGV0b1VzZXIoJHNjb3BlLmJ1c2luZXNzZXNbaW5kZXhdLCBQcm9maWxlLl9pZClcbiAgICAgIH0pICAgIFxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnIgaW4gYnVzaW5lc3NDdHJsOiBcIiwgZXJyKTtcbiAgICAgIH0pXG4gICAgfVxufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdpbWFnZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVwbG9hZCwgUHJvZmlsZSwgJHJvb3RTY29wZSkge1xuICBjb25zb2xlLmxvZyhcImltYWdlIGN0cmxcIik7XG5cblxuICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gUHJvZmlsZTtcblxuICAkc2NvcGUuc3VibWl0ID0gKCkgPT57XG4gICAgY29uc29sZS5sb2coJ3N1Ym1pdCcpO1xuICAgIGNvbnNvbGUubG9nKCckc2NvcGUuZmlsZTonLCAkc2NvcGUuZmlsZSk7XG4gICAgXG4gICAgVXBsb2FkLnVwbG9hZCh7XG4gICAgICB1cmw6ICcvYXBpL2ltYWdlcycsXG4gICAgICBkYXRhOiB7cGhvdG86ICRzY29wZS5maWxlLCB1c2VyOiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLl9pZH0gLy9hbnl0aGluZyBlbHNlIGxpa2UgbmFtZSB3aWxsIGVuZCB1cCBpbiByZXEuYm9keVxuICAgIH0pXG4gICAgLnRoZW4ocmVzID0+e1xuICAgICAgY29uc29sZS5sb2coJ3JlczogJywgcmVzKTtcbiAgICAgICRzY29wZS5zYXZlZEltYWdlID0gcmVzLmRhdGE7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycilcbiAgICB9KVxuICB9O1xuXG59KTtcblxuICAvKiRzY29wZS5jcnVkcyA9IFtdO1xuXG4gIENydWQuZ2V0QWxsKClcbiAgLnRoZW4ocmVzID0+e1xuICAgICRzY29wZS5jcnVkcyA9IHJlcy5kYXRhO1xuICAgIGNvbnNvbGUubG9nKFwiJHNjb3BlLmNydWRzOlwiLCAkc2NvcGUuY3J1ZHMpO1xuICB9KVxuICAuY2F0Y2goZXJyID0+e1xuICAgIGNvbnNvbGUubG9nKFwiZXJyOiBcIiwgZXJyKTtcbiAgfSlcblxuICAkc2NvcGUuYWRkQ3J1ZCA9ICgpID0+e1xuICAgIENydWQuYWRkQ3J1ZCgkc2NvcGUubmV3SXRlbSlcbiAgICAudGhlbihjcnVkID0+e1xuICAgICAgJHNjb3BlLmNydWRzLnB1c2goY3J1ZCk7XG4gICAgICAkc2NvcGUubmV3SXRlbSA9IHt9O1xuICAgIH0pXG4gICAgLmNhdGNoKGVycj0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnJvcjogXCIsIGVyciApO1xuICAgIH0pO1xuICB9XG5cblxuICAkc2NvcGUuZGVsZXRlQ3J1ZCA9IChpbmQsIGNydWQpID0+e1xuICAgIGNvbnNvbGUubG9nKFwiY3J1ZDpcIiwgY3J1ZClcbiAgICBDcnVkLmRlbGV0ZUNydWQoY3J1ZC5faWQpXG4gICAgLnRoZW4oY3J1ZCA9PiB7XG4gICAgICAkc2NvcGUuY3J1ZHMuc3BsaWNlKGluZCwxKTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnI9PntcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3I6IFwiLCBlcnIgKTtcbiAgICB9KTtcbiAgfVxuXG4gICRzY29wZS5zaG93VXBkYXRlRm9ybSA9IChpbmRleCwgY3J1ZCkgPT57XG4gICAgY29uc29sZS5sb2coXCJpbmRleDogXCIsIGluZGV4KTtcbiAgICBjb25zb2xlLmxvZyhcImNydWQ6IFwiLCBjcnVkKTtcbiAgICAkc2NvcGUuc2hvd1VwZGF0ZSA9dHJ1ZTtcbiAgICAkc2NvcGUudXBkYXRlSXRlbSA9IGNydWQ7XG4gICAgJHNjb3BlLnVwZGF0ZUluZGV4ID0gaW5kZXg7XG4gIH1cblxuICAkc2NvcGUudXBkYXRlQ3J1ZD0gKCkgPT57XG4gICAgJHNjb3BlLnNob3dVcGRhdGUgPWZhbHNlO1xuICAgIENydWQudXBkYXRlQ3J1ZCgkc2NvcGUudXBkYXRlSXRlbS5faWQsICRzY29wZS51cGRhdGVJdGVtKVxuICAgIC50aGVuKGNydWQgPT57XG4gICAgICBjb25zb2xlLmxvZyhcInVwZGF0ZSBhcHQ6XCIgLCAkc2NvcGUudXBkYXRlSXRlbS5faWQsIFwiICwgXCIgLCAkc2NvcGUudXBkYXRlSXRlbSk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyPT57XG4gICAgICBjb25zb2xlLmxvZyhcImVycm9yOiBcIiwgZXJyICk7XG4gICAgfSk7XG4gIH1cbiovXG5cbiIsIlxuJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgsICRyb290U2NvcGUpIHtcbiAgY29uc29sZS5sb2coJ2xvZ2luQ3RybCEnKTtcblxuICAkc2NvcGUubG9naW4gPSAoKSA9PiB7XG4gICAgICAkYXV0aC5sb2dpbigkc2NvcGUudXNlcilcbiAgICAgIC50aGVuKHJlcyA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJyZXM6IFwiLCByZXMpO1xuICAgICAgICAvLyRyb290U2NvcGUuY3VycmVudFVzZXIgPSByZXMuZGF0YTtcbiAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgICB9KVxuICAgIH07XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmxldCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ21haW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRhdXRoLCAkcm9vdFNjb3BlKSB7XG4gIGNvbnNvbGUubG9nKCdtYWluQ3RybCEnKTtcblxuICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyO1xuXG4gICRzY29wZS5pc0F1dGhlbnRpY2F0ZWQgPSAoKSA9PiAkYXV0aC5pc0F1dGhlbnRpY2F0ZWQoKTtcblxuICAkc2NvcGUubG9nb3V0ID0gKCkgPT4ge1xuICAgICRhdXRoLmxvZ291dCgpO1xuICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICB9O1xuXG4gICRzY29wZS5hdXRoZW50aWNhdGUgPSBwcm92aWRlciA9PiB7XG4gICAgJGF1dGguYXV0aGVudGljYXRlKHByb3ZpZGVyKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcbiAgICAgIH0pXG4gIH07XG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxubGV0IGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuY29udHJvbGxlcigncHJvZmlsZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFByb2ZpbGUsIFByb2ZpbGVCeUlELCAkc3RhdGUsIFVzZXIsICRyb290U2NvcGUsIFdhbGxQb3N0KSB7XG4gIFxuICBjb25zb2xlLmxvZygncHJvZmlsZUN0cmwhJyk7XG5cbiAgJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IFByb2ZpbGU7XG5cbiAgJHNjb3BlLnVzZXIgPSBQcm9maWxlQnlJRCB8fCBQcm9maWxlO1xuXG4gIFdhbGxQb3N0LmdldFdhbGxQb3N0cygkc2NvcGUudXNlci5faWQpXG4gICAgLnRoZW4ocmVzID0+e1xuICAgICRzY29wZS51c2VyV2FsbHBvc3RzID0gcmVzO1xuICB9KVxuXG4gIGNvbnNvbGUubG9nKFwidXNlcjpcIiwgJHNjb3BlLnVzZXIgKTtcbiAgY29uc29sZS5sb2coXCJjdXJydXNlcjpcIiwgJHJvb3RTY29wZS5jdXJyZW50VXNlciApO1xuXG4gICRzY29wZS5zaG93ZGlzcGxheU5hbWVGb3JtID0gKCkgPT57XG4gICAgY29uc29sZS5sb2coXCJzaG93IGZvcm1cIik7XG4gICAgJHNjb3BlLmRpc3BsYXlOYW1lRm9ybSA9IHRydWU7XG4gIH1cblxuICAkc2NvcGUudXBkYXRlZGlzcGxheU5hbWUgPSAoKSA9PiB7XG4gICAgJHNjb3BlLmRpc3BsYXlOYW1lRm9ybSA9IGZhbHNlO1xuICAgICRzY29wZS51c2VyLmRpc3BsYXlOYW1lID0gJHNjb3BlLm5ld0l0ZW0uZGlzcGxheU5hbWU7XG4gICAgVXNlci51cGRhdGVQcm9maWxlKCRzY29wZS51c2VyLl9pZCwgJHNjb3BlLm5ld0l0ZW0pXG4gICAgICAudGhlbihwcm9maWxlID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInByb2ZpbGU6XCIsIHByb2ZpbGUpO1xuICAgICAgICAkc2NvcGUubmV3SXRlbS5kaXNwbGF5TmFtZSA9ICcnO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyOlwiLCBlcnIpO1xuICAgICAgfSlcbiAgfVxuXG4gICRzY29wZS5jYW5jZWxkaXNwbGF5TmFtZSA9ICgpID0+e1xuICAgICRzY29wZS51c2VybmFtZUZvcm0gPSB0cnVlO1xuICAgICRzY29wZS5uZXdJdGVtLmRpc3BsYXlOYW1lID0gJyc7XG4gIH1cblxuLy9waG90b1xuICAkc2NvcGUuc2hvd1BpY3R1cmVGb3JtID0gKCkgPT57XG4gICAgY29uc29sZS5sb2coXCJzaG93IGZvcm1cIik7XG4gICAgJHNjb3BlLnBob3RvRm9ybSA9IHRydWU7XG4gIH1cblxuICAkc2NvcGUudXBkYXRlUGljdHVyZSA9ICgpID0+IHtcbiAgICAkc2NvcGUucGhvdG9Gb3JtID0gZmFsc2U7XG4gICAgY29uc29sZS5sb2coXCIkc3RhdGUuY3VycmVudDogXCIsICRzdGF0ZS5jdXJyZW50KTtcbiAgICAkc2NvcGUudXNlci5wcm9maWxlSW1hZ2UgPSAkc2NvcGUubmV3SXRlbS5wcm9maWxlSW1hZ2U7XG4gICAgY29uc29sZS5sb2coXCIkc2NvcGUubmV3SXRlbTpcIiwgJHNjb3BlLm5ld0l0ZW0pO1xuICAgIFVzZXIudXBkYXRlUHJvZmlsZSgkc2NvcGUudXNlci5faWQsICRzY29wZS5uZXdJdGVtKVxuICAgICAgLnRoZW4ocHJvZmlsZSA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJwcm9maWxlOlwiLCBwcm9maWxlKTtcbiAgICAgICAgJHNjb3BlLm5ld0l0ZW0ucHJvZmlsZUltYWdlID0gJyc7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgICB9KVxuICB9XG5cbiAgJHNjb3BlLmNhbmNlbFBob3RvVXJsID0gKCkgPT57XG4gICAgJHNjb3BlLnBob3RvRm9ybSA9IHRydWU7XG4gICAgJHNjb3BlLm5ld0l0ZW0ucGhvdG9VcmwgPSAnJztcbiAgfVxuXG5cbiAgJHNjb3BlLmRlbGV0ZUFjY291bnQgPSAodXNlcikgPT57XG4gICAgLy9hZGQgc3dhbFxuICAgIGNvbnNvbGUubG9nKHVzZXIuX2lkKTtcbiAgICBVc2VyLmRlbGV0ZUFjY291bnQodXNlci5faWQpXG4gICAgICAudGhlbigpXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycjogXCIsIGVycik7XG4gICAgICB9KTtcbiAgfVxuXG4gICAgJHNjb3BlLnN1Ym1pdE1lc3NhZ2UgPSAoKSA9PntcblxuICAgIHZhciBwb3N0T2JqID0ge1xuICAgICAgdG86ICRzY29wZS51c2VyLFxuICAgICAgZnJvbTogJHJvb3RTY29wZS5jdXJyZW50VXNlci5faWQsXG4gICAgICBmcm9tTmFtZTogJHJvb3RTY29wZS5jdXJyZW50VXNlci5kaXNwbGF5TmFtZSxcbiAgICAgIHRleHQ6ICRzY29wZS5uZXdJdGVtLnRleHQsXG4gICAgICBjcmVhdGVkQXQ6IFwiYWRkIG1vbWVudFwiXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKFwicG9zdCBvYmo6XCIsIHBvc3RPYmopO1xuXG5cbiAgICBXYWxsUG9zdC5hZGRXYWxsUG9zdChwb3N0T2JqKVxuICAgICAgLnRoZW4od2FsbHBvc3QgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwid2FsbHBvc3Q6XCIgLCB3YWxscG9zdCk7XG4gICAgICAgIFVzZXIuYWRkV2FsbFBvc3RUb1VzZXIoUHJvZmlsZUJ5SUQuX2lkLCB3YWxscG9zdC5faWQpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCRzdGF0ZS5nbygkc3RhdGUuJGN1cnJlbnQsIG51bGwsIHsgcmVsb2FkOiB0cnVlIH0pKVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnI6IFwiLCBlcnIpO1xuICAgICAgfSlcbiAgIH07XG5cblxufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdyZWdpc3RlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgpIHtcbiAgY29uc29sZS5sb2coJ3JlZ2lzdGVyQ3RybCEnKTtcblxuICAkc2NvcGUucmVnaXN0ZXIgPSAoKSA9PiB7XG4gICAgaWYoJHNjb3BlLnVzZXIucGFzc3dvcmQgIT09ICRzY29wZS51c2VyLnBhc3N3b3JkMil7XG4gICAgICAkc2NvcGUudXNlci5wYXNzd29yZCA9IG51bGw7XG4gICAgICAkc2NvcGUudXNlci5wYXNzd29yZDIgPSBudWxsO1xuICAgICAgYWxlcnQoJ1Bhc3N3b3JkcyBtdXN0IG1hdGNoIScpO1xuICAgIH1lbHNle1xuICAgICAgJGF1dGguc2lnbnVwKCRzY29wZS51c2VyKVxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlczogXCIsIHJlcyk7XG4gICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKTtcbiAgICAgIH0pXG4gICAgfVxuICB9O1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdzaG93YnVzaW5lc3NDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIEJ1c2luZXNzKSB7XG4gIGNvbnNvbGUubG9nKCdzaG93YnVzaW5lc3NDdHJsIScpO1xuXG4gIGxldCBidXNpbmVzc0lkID0gJHN0YXRlUGFyYW1zO1xuICBjb25zb2xlLmxvZyhcImJ1c2luZXNzSWRcIiwgYnVzaW5lc3NJZC5idXNpbmVzc0lkKTtcblxuICBCdXNpbmVzcy5zZWFyY2hZZWxwKGJ1c2luZXNzSWQuYnVzaW5lc3NJZClcbiAgLnRoZW4ocmVzID0+e1xuICAgIGNvbnNvbGUubG9nKFwicmVzOlwiICwgcmVzKTtcbiAgICAkc2NvcGUuYnVzaW5lc3MgPSByZXM7XG4gIH0pICAgIFxuICAuY2F0Y2goZXJyID0+e1xuICAgIGNvbnNvbGUubG9nKFwiZXJyIGluIGJ1c2luZXNzQ3RybDogXCIsIGVycik7XG4gIH0pXG5cbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCd1c2Vyc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsICQkc3RhdGUsICRzdGF0ZSwgVXNlcikge1xuICBjb25zb2xlLmxvZygndXNlcnNDdHJsIScpO1xuXG4gIHZhciB1c2VyUHJvbWlzZSA9IFVzZXIuZ2V0QWxsKCk7XG4gIGNvbnNvbGUubG9nKFwidXNlclByb21pc2U6XCIsIHVzZXJQcm9taXNlKTtcbiAgdXNlclByb21pc2UudGhlbihcbiAgICBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQuZGF0YSk7XG4gICAgICAgJHNjb3BlLnVzZXJGZWVkID0gcmVzdWx0LmRhdGE7XG4gICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLnNlcnZpY2UoJ0J1c2luZXNzJywgZnVuY3Rpb24oJGh0dHAsICRxKXtcblxuICB0aGlzLnNlYXJjaFllbHAgPSAoc2VhcmNoKSA9PntcbiAgICBjb25zb2xlLmxvZyhcInNlYXJjaDogXCIsIHNlYXJjaCk7XG4gICAgcmV0dXJuICRodHRwLmdldChgL2FwaS9idXNpbmVzc2VzL3llbHAvJHtzZWFyY2h9YClcbiAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZXMuZGF0YSBpbiBzZXJ2aWNlczpcIiwgcmVzLmRhdGEpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlcyBpbiBzZXJ2aWNlczpcIiwgcmVzKTtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4geyAgIFxuICAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgICB9KVxuICB9XG5cbiAgdGhpcy5hZGRGYXZvcml0ZSA9IChidXNpbmVzc09iaiwgdXNlcklkKSA9PntcbiAgICBjb25zb2xlLmxvZyhcImJ1c2luZXNzT2JqOlwiLCBidXNpbmVzc09iaik7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoYC9hcGkvYnVzaW5lc3Nlcy8ke3VzZXJJZH1gLCBidXNpbmVzc09iailcbiAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlcyBsbiAyNCBidXNpbmVzcyBzZXJ2aWNlczpcIiwgcmVzKTtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHsgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuICAgICAgfSlcbiAgICB9O1xufSk7XG5cbi8vZG8gZmluZCwgaWYgbm90IGluIGRiIHRoZW4gYWRkLCBpZiBpbiBkYiBhZGQgdXNlciB0byBmYXZvcml0ZWQiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLnNlcnZpY2UoJ2ltYWdlJywgZnVuY3Rpb24oJGh0dHAsICRxKXtcblxuICB0aGlzLmdldEFsbCA9ICgpID0+e1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvY3J1ZHMnKTtcbiAgfVxuXG4gIHRoaXMuZ2V0QnlJZCA9IGlkID0+e1xuICAgIHJldHVybiAkaHR0cC5nZXQoYC9hcGkvY3J1ZHMvJHtpZH1gKTtcbiAgfVxuXG4gIHRoaXMuYWRkQ3J1ZD0gKGNydWQpID0+e1xuICAgIHJldHVybiAkaHR0cC5wb3N0KGAvYXBpL2NydWRzYCwgY3J1ZClcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKHJlcy5kYXRhKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHsgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuICAgICAgfSlcbiAgICB9O1xuXG4gIHRoaXMuZGVsZXRlQ3J1ZCA9IChpZCkgPT57XG4gICAgcmV0dXJuICRodHRwLmRlbGV0ZShgL2FwaS9jcnVkcy8ke2lkfWApXG4gICAgICAudGhlbiggKCkgPT4ge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4geyAgIFxuICAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgICB9KVxuICAgIH07XG5cbiAgdGhpcy51cGRhdGVDcnVkID0gKGlkLCBjcnVkKSA9PntcbiAgICAgIHJldHVybiAkaHR0cC5wdXQoYC9hcGkvY3J1ZHMvJHtpZH1gLCBjcnVkKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUoY3J1ZCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7ICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcbiAgICAgIH0pXG4gICAgfTtcblxufSk7XG5cbi8vaW4gcmVzaWRlbnRzIFJlc2lkZW50LmdldEFsbCgpXG4vLyAgICAgICAgICAgICAgICAudGhlbihyZXNpZGVudHMgPT57fSkiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLnNlcnZpY2UoJ1VzZXInLCBmdW5jdGlvbigkaHR0cCwgJHEpIHtcblxuICB0aGlzLnByb2ZpbGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2Vycy9wcm9maWxlJylcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKHJlcy5kYXRhKTtcbiAgICAgIH0pO1xuICB9O1xuXG4gIHRoaXMuZ2V0UHJvZmlsZSA9IChpZCkgPT57XG4gICAgIHJldHVybiAkaHR0cC5nZXQoYC9hcGkvdXNlcnMvcHJvZmlsZS8ke2lkfWApXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PntcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyOlwiLCBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgdGhpcy5nZXRBbGwgPSAoKSA9PntcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gIH1cblxuICB0aGlzLnVwZGF0ZVByb2ZpbGUgPSAoaWQsIHByb2ZpbGVPYmopID0+e1xuICAgIGNvbnNvbGUubG9nKFwiaGVyZVwiKTtcbiAgICBjb25zb2xlLmxvZyhpZCAsIFwiIFwiICxwcm9maWxlT2JqKTtcbiAgICByZXR1cm4gJGh0dHAucHV0KGAvYXBpL3VzZXJzL3Byb2ZpbGUvJHtpZH1gLCAgcHJvZmlsZU9iailcbiAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PntcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyOlwiLCBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgdGhpcy5kZWxldGVBY2NvdW50ID0gKGlkKSA9PntcbiAgICByZXR1cm4gJGh0dHAuZGVsZXRlKGAvYXBpL3VzZXJzL3Byb2ZpbGUvJHtpZH1gKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmFkZEZhdm9yaXRlVG9Vc2VyID0gKGlkLCB5ZWxwSWQpID0+e1xuICAgIGNvbnNvbGUubG9nKFwiYWRkRmF2b3JpdGVUb1VzZXJcIiwgXCJpZDpcIiwgaWQsIFwieWVscElkXCIsIHllbHBJZClcbiAgICByZXR1cm4gJGh0dHAucHV0KGAvYXBpL3VzZXJzL3Byb2ZpbGUvJHtpZH0vJHt5ZWxwSWR9YClcbiAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZXMgbG4gNTM6XCIsIHJlcyk7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgfSk7XG4gIH1cbiBcblxufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLnNlcnZpY2UoJ1dhbGxQb3N0JywgZnVuY3Rpb24oJGh0dHAsICRxKSB7XG5cbiAgICB0aGlzLmFkZFdhbGxQb3N0PSAod2FsbHBvc3QpID0+e1xuICAgIGNvbnNvbGUubG9nKFwiaW4gYWRkIHdhbGxwb3N0OiBcIiwgd2FsbHBvc3QpO1xuICAgIHJldHVybiAkaHR0cC5wb3N0KGAvYXBpL3dhbGxwb3N0c2AsIHdhbGxwb3N0KVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4geyAgIFxuICAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgICB9KVxuICAgIH07XG5cblxuICAgIHRoaXMuZ2V0V2FsbFBvc3RzID0gKHVzZXJJZCkgPT57XG4gICAgcmV0dXJuICRodHRwLmdldChgL2FwaS93YWxscG9zdHMvJHt1c2VySWR9YClcbiAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKHJlcy5kYXRhKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyOiBcIiwgZXJyKTtcbiAgICAgIH0pO1xuICB9O1xuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
