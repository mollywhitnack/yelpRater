"use strict";var app=angular.module("myApp",["ui.router","satellizer","ngFileUpload"]);app.config(["$authProvider",function(e){e.loginUrl="api/users/login",e.signupUrl="api/users/signup",e.facebook({clientId:"255060128209165",url:"/api/users/facebook"})}]),app.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/",templateUrl:"/html/home.html"}).state("login",{url:"/login",templateUrl:"/html/login.html",controller:"loginCtrl"}).state("register",{url:"/register",templateUrl:"/html/register.html",controller:"registerCtrl"}).state("profile",{url:"/profile/:userId",templateUrl:"/html/profile.html",controller:"profileCtrl",resolve:{Profile:["User",function(e){return e.profile()}],ProfileByID:["User","$stateParams",function(e,o){return e.getProfile(o.userId)}]}}).state("users",{url:"/users",templateUrl:"/html/users.html",controller:"usersCtrl"}).state("business",{url:"/business",templateUrl:"/html/business.html",controller:"businessCtrl",resolve:{Profile:["User",function(e){return e.profile()}]}}).state("showBusiness",{url:"/business/:businessId",templateUrl:"html/showbusiness.html",controller:"showbusinessCtrl"}),o.otherwise("/")}]);var app=angular.module("myApp");app.controller("businessCtrl",["$scope","User","$rootScope","Business","Profile",function(e,o,n,s,t){console.log("businessCtrl"),e.businesses=[],console.log("Profile:",t);var r=t.favorites;e.searchBusiness=function(){console.log("$scope.newItem.searchParams",e.newItem.searchParams),s.searchYelp(e.newItem.searchParams).then(function(o){console.log("res from search businsess:",o);for(var n=0;n<r.length;n++)console.log(o.id," vs ",r[n]),o.id===r[n]&&(e.toggleFave=!0);e.businesses.push(o)})["catch"](function(e){console.log("err in businessCtrl: ",e)})},e.favorite=function(n){e.toggleFave=!e.toggleFave,console.log("$scope.businesses[index].id",e.businesses[n].id),o.addFavoriteToUser(t._id,e.businesses[n].id).then(s.addFavorite(e.businesses[n],t._id)).then(function(e){console.log("res:",e)})["catch"](function(e){console.log("err in businessCtrl: ",e)}),console.log("$scope.businesses[index]:",e.businesses[n].id)},e.unFavorite=function(n){e.toggleFave=!e.toggleFave,console.log("$scope.businesses[index].id",e.businesses[n].id),o.removeFavoritefromUser(t._id,e.businesses[n].id).then(function(e){console.log("res:",e)})["catch"](function(e){console.log("err in businessCtrl: ",e)}),console.log("$scope.businesses[index]:",e.businesses[n].id)}}]);var app=angular.module("myApp");app.controller("imageCtrl",["$scope","Upload","Profile","$rootScope",function(e,o,n,s){console.log("image ctrl"),s.currentUser=n,e.submit=function(){console.log("submit"),console.log("$scope.file:",e.file),o.upload({url:"/api/images",data:{photo:e.file,user:s.currentUser._id}}).then(function(o){console.log("res: ",o),e.savedImage=o.data})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("loginCtrl",["$scope","$state","$auth","$rootScope",function(e,o,n,s){console.log("loginCtrl!"),e.login=function(){n.login(e.user).then(function(e){console.log("res: ",e),o.go("profile")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("mainCtrl",["$scope","$state","$auth","$rootScope",function(e,o,n,s){console.log("mainCtrl!"),s.currentUser,e.isAuthenticated=function(){return n.isAuthenticated()},e.logout=function(){n.logout(),o.go("home")},e.authenticate=function(e){n.authenticate(e).then(function(e){o.go("home")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("profileCtrl",["$scope","Profile","ProfileByID","$state","User","$rootScope","WallPost",function(e,o,n,s,t,r,l){console.log("profileCtrl!"),r.currentUser=o,e.user=n||o,l.getWallPosts(e.user._id).then(function(o){e.userWallposts=o}),console.log("user:",e.user),console.log("curruser:",r.currentUser),e.showdisplayNameForm=function(){console.log("show form"),e.displayNameForm=!0},e.updatedisplayName=function(){e.displayNameForm=!1,e.user.displayName=e.newItem.displayName,t.updateProfile(e.user._id,e.newItem).then(function(o){console.log("profile:",o),e.newItem.displayName=""})["catch"](function(e){console.log("err:",e)})},e.canceldisplayName=function(){e.usernameForm=!0,e.newItem.displayName=""},e.showPictureForm=function(){console.log("show form"),e.photoForm=!0},e.updatePicture=function(){e.photoForm=!1,console.log("$state.current: ",s.current),e.user.profileImage=e.newItem.profileImage,console.log("$scope.newItem:",e.newItem),t.updateProfile(e.user._id,e.newItem).then(function(o){console.log("profile:",o),e.newItem.profileImage=""})["catch"](function(e){console.log("err:",e)})},e.cancelPhotoUrl=function(){e.photoForm=!0,e.newItem.photoUrl=""},e.deleteAccount=function(e){console.log(e._id),t.deleteAccount(e._id).then()["catch"](function(e){console.log("err: ",e)})},e.submitMessage=function(){var o={to:e.user,from:r.currentUser._id,fromName:r.currentUser.displayName,text:e.newItem.text,createdAt:"add moment"};console.log("post obj:",o),l.addWallPost(o).then(function(e){console.log("wallpost:",e),t.addWallPostToUser(n._id,e._id)}).then(s.go(s.$current,null,{reload:!0}))["catch"](function(e){console.log("err: ",e)})}}]);var app=angular.module("myApp");app.controller("registerCtrl",["$scope","$state","$auth",function(e,o,n){console.log("registerCtrl!"),e.register=function(){e.user.password!==e.user.password2?(e.user.password=null,e.user.password2=null,alert("Passwords must match!")):n.signup(e.user).then(function(e){console.log("res: ",e),o.go("login")})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.controller("showbusinessCtrl",["$scope","$stateParams","Business",function(e,o,n){console.log("showbusinessCtrl!");var s=o;console.log("businessId",s.businessId),n.searchYelp(s.businessId).then(function(o){console.log("res:",o),e.business=o})["catch"](function(e){console.log("err in businessCtrl: ",e)})}]);var app=angular.module("myApp");app.controller("usersCtrl",["$scope","$$state","$state","User",function(e,o,n,s){console.log("usersCtrl!");var t=s.getAll();console.log("userPromise:",t),t.then(function(o){console.log(o.data),e.userFeed=o.data})}]);var app=angular.module("myApp");app.service("Business",["$http","$q",function(e,o){this.searchYelp=function(n){return console.log("search: ",n),e.get("/api/businesses/yelp/"+n).then(function(e){return console.log("res.data in services:",e.data),console.log("res in services:",e),o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.addFavorite=function(n,s){return console.log("businessObj:",n),e.post("/api/businesses/"+s,n).then(function(e){return console.log("res ln 24 business services:",e),o.resolve(e)})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("image",["$http","$q",function(e,o){this.getAll=function(){return e.get("/api/cruds")},this.getById=function(o){return e.get("/api/cruds/"+o)},this.addCrud=function(n){return e.post("/api/cruds",n).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.deleteCrud=function(n){return e["delete"]("/api/cruds/"+n).then(function(){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.updateCrud=function(n,s){return e.put("/api/cruds/"+n,s).then(function(e){return o.resolve(s)})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("User",["$http","$q",function(e,o){this.profile=function(){return e.get("/api/users/profile").then(function(e){return o.resolve(e.data)})},this.getProfile=function(n){return e.get("/api/users/profile/"+n).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.getAll=function(){return e.get("/api/users")},this.updateProfile=function(n,s){return console.log("here"),console.log(n," ",s),e.put("/api/users/profile/"+n,s).then(function(e){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.deleteAccount=function(n){return e["delete"]("/api/users/profile/"+n).then(function(e){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.addFavoriteToUser=function(n,s){return e.put("/api/users/profile/"+n+"/add/"+s).then(function(e){return o.resolve()})["catch"](function(e){console.log("err:",e)})},this.removeFavoritefromUser=function(n,s){return console.log("remove Favorite","id:",n,"yelpId",s),e.put("/api/users/profile/"+n+"/remove/"+s).then(function(e){return console.log("res ln 53:",e),o.resolve()})["catch"](function(e){console.log("err:",e)})}}]);var app=angular.module("myApp");app.service("WallPost",["$http","$q",function(e,o){this.addWallPost=function(n){return console.log("in add wallpost: ",n),e.post("/api/wallposts",n).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err:",e)})},this.getWallPosts=function(n){return e.get("/api/wallposts/"+n).then(function(e){return o.resolve(e.data)})["catch"](function(e){console.log("err: ",e)})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2J1c2luZXNzQ3RybC5qcyIsImNvbnRyb2xsZXJzL2ltYWdlQ3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ3RybC5qcyIsImNvbnRyb2xsZXJzL21haW5DdHJsLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUN0cmwuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckN0cmwuanMiLCJjb250cm9sbGVycy9zaG93YnVzaW5lc3NDdHJsLmpzIiwiY29udHJvbGxlcnMvdXNlcnNDdHJsLmpzIiwic2VydmljZXMvYnVzaW5lc3NzZXJ2aWNlcy5qcyIsInNlcnZpY2VzL2ltYWdlc2VydmljZXMuanMiLCJzZXJ2aWNlcy91c2Vyc2VydmljZXMuanMiLCJzZXJ2aWNlcy93YWxscG9zdHNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkYXV0aFByb3ZpZGVyIiwibG9naW5VcmwiLCJzaWdudXBVcmwiLCJmYWNlYm9vayIsImNsaWVudElkIiwidXJsIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInJlc29sdmUiLCJQcm9maWxlIiwiVXNlciIsInByb2ZpbGUiLCJQcm9maWxlQnlJRCIsIiRzdGF0ZVBhcmFtcyIsImdldFByb2ZpbGUiLCJ1c2VySWQiLCJvdGhlcndpc2UiLCIkc2NvcGUiLCIkcm9vdFNjb3BlIiwiQnVzaW5lc3MiLCJjb25zb2xlIiwibG9nIiwiYnVzaW5lc3NlcyIsImZhdm9yaXRlcyIsInNlYXJjaEJ1c2luZXNzIiwibmV3SXRlbSIsInNlYXJjaFBhcmFtcyIsInNlYXJjaFllbHAiLCJ0aGVuIiwicmVzIiwiaSIsImxlbmd0aCIsImlkIiwidG9nZ2xlRmF2ZSIsInB1c2giLCJlcnIiLCJmYXZvcml0ZSIsImluZGV4IiwiYWRkRmF2b3JpdGVUb1VzZXIiLCJfaWQiLCJhZGRGYXZvcml0ZSIsInVuRmF2b3JpdGUiLCJyZW1vdmVGYXZvcml0ZWZyb21Vc2VyIiwiVXBsb2FkIiwiY3VycmVudFVzZXIiLCJzdWJtaXQiLCJmaWxlIiwidXBsb2FkIiwiZGF0YSIsInBob3RvIiwidXNlciIsInNhdmVkSW1hZ2UiLCIkc3RhdGUiLCIkYXV0aCIsImxvZ2luIiwiZ28iLCJpc0F1dGhlbnRpY2F0ZWQiLCJsb2dvdXQiLCJhdXRoZW50aWNhdGUiLCJwcm92aWRlciIsIldhbGxQb3N0IiwiZ2V0V2FsbFBvc3RzIiwidXNlcldhbGxwb3N0cyIsInNob3dkaXNwbGF5TmFtZUZvcm0iLCJkaXNwbGF5TmFtZUZvcm0iLCJ1cGRhdGVkaXNwbGF5TmFtZSIsImRpc3BsYXlOYW1lIiwidXBkYXRlUHJvZmlsZSIsImNhbmNlbGRpc3BsYXlOYW1lIiwidXNlcm5hbWVGb3JtIiwic2hvd1BpY3R1cmVGb3JtIiwicGhvdG9Gb3JtIiwidXBkYXRlUGljdHVyZSIsImN1cnJlbnQiLCJwcm9maWxlSW1hZ2UiLCJjYW5jZWxQaG90b1VybCIsInBob3RvVXJsIiwiZGVsZXRlQWNjb3VudCIsInN1Ym1pdE1lc3NhZ2UiLCJwb3N0T2JqIiwidG8iLCJmcm9tIiwiZnJvbU5hbWUiLCJ0ZXh0IiwiY3JlYXRlZEF0IiwiYWRkV2FsbFBvc3QiLCJ3YWxscG9zdCIsImFkZFdhbGxQb3N0VG9Vc2VyIiwiJGN1cnJlbnQiLCJyZWxvYWQiLCJyZWdpc3RlciIsInBhc3N3b3JkIiwicGFzc3dvcmQyIiwiYWxlcnQiLCJzaWdudXAiLCJidXNpbmVzc0lkIiwiYnVzaW5lc3MiLCIkJHN0YXRlIiwidXNlclByb21pc2UiLCJnZXRBbGwiLCJyZXN1bHQiLCJ1c2VyRmVlZCIsInNlcnZpY2UiLCIkaHR0cCIsIiRxIiwidGhpcyIsInNlYXJjaCIsImdldCIsImJ1c2luZXNzT2JqIiwicG9zdCIsImdldEJ5SWQiLCJhZGRDcnVkIiwiY3J1ZCIsImRlbGV0ZUNydWQiLCJ1cGRhdGVDcnVkIiwicHV0IiwicHJvZmlsZU9iaiIsInll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c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcsIFsndWkucm91dGVyJywgJ3NhdGVsbGl6ZXInLCAnbmdGaWxlVXBsb2FkJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRhdXRoUHJvdmlkZXIpIHtcblxuICAkYXV0aFByb3ZpZGVyLmxvZ2luVXJsID0gJ2FwaS91c2Vycy9sb2dpbic7XG4gICRhdXRoUHJvdmlkZXIuc2lnbnVwVXJsID0gJ2FwaS91c2Vycy9zaWdudXAnO1xuXG4gICRhdXRoUHJvdmlkZXIuZmFjZWJvb2soe1xuICAgIGNsaWVudElkOiAnMjU1MDYwMTI4MjA5MTY1JyxcbiAgICB1cmw6ICcvYXBpL3VzZXJzL2ZhY2Vib29rJ1xuICB9KTtcblxufSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdob21lJywgeyB1cmw6ICcvJywgdGVtcGxhdGVVcmw6ICcvaHRtbC9ob21lLmh0bWwnIH0pXG4gICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9odG1sL2xvZ2luLmh0bWwnLFxuICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ3RybCdcbiAgICB9KVxuICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XG4gICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3Rlci5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdyZWdpc3RlckN0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XG4gICAgICB1cmw6ICcvcHJvZmlsZS86dXNlcklkJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvcHJvZmlsZS5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIFByb2ZpbGU6IGZ1bmN0aW9uKFVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gVXNlci5wcm9maWxlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIFByb2ZpbGVCeUlEOiBmdW5jdGlvbihVc2VyLCAkc3RhdGVQYXJhbXMpe1xuICAgICAgICAgIHJldHVybiBVc2VyLmdldFByb2ZpbGUoJHN0YXRlUGFyYW1zLnVzZXJJZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgndXNlcnMnLCB7XG4gICAgICB1cmw6ICcvdXNlcnMnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC91c2Vycy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICd1c2Vyc0N0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ2J1c2luZXNzJywge1xuICAgICAgdXJsOiAnL2J1c2luZXNzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL2h0bWwvYnVzaW5lc3MuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDdHJsJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgUHJvZmlsZTogZnVuY3Rpb24oVXNlcikge1xuICAgICAgICAgIHJldHVybiBVc2VyLnByb2ZpbGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdzaG93QnVzaW5lc3MnLCB7XG4gICAgICB1cmw6ICcvYnVzaW5lc3MvOmJ1c2luZXNzSWQnLCBcbiAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9zaG93YnVzaW5lc3MuaHRtbCcsIFxuICAgICAgY29udHJvbGxlcjogJ3Nob3didXNpbmVzc0N0cmwnXG4gICAgICB9KVxuICAgIFxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KTtcblxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdidXNpbmVzc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXIsICRyb290U2NvcGUsIEJ1c2luZXNzLCBQcm9maWxlKXtcbiAgY29uc29sZS5sb2coXCJidXNpbmVzc0N0cmxcIik7XG5cbiAgJHNjb3BlLmJ1c2luZXNzZXMgPSBbXTtcbiAgY29uc29sZS5sb2coXCJQcm9maWxlOlwiLCBQcm9maWxlKVxuICB2YXIgZmF2b3JpdGVzID0gUHJvZmlsZS5mYXZvcml0ZXM7XG5cbiAgJHNjb3BlLnNlYXJjaEJ1c2luZXNzID0gKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCIkc2NvcGUubmV3SXRlbS5zZWFyY2hQYXJhbXNcIiAsICRzY29wZS5uZXdJdGVtLnNlYXJjaFBhcmFtcylcbiAgICAgIEJ1c2luZXNzLnNlYXJjaFllbHAoJHNjb3BlLm5ld0l0ZW0uc2VhcmNoUGFyYW1zKVxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlcyBmcm9tIHNlYXJjaCBidXNpbnNlc3M6XCIgLCByZXMpO1xuICAgICAgICBmb3IodmFyIGk9MDsgaTwgZmF2b3JpdGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuaWQgLFwiIHZzIFwiLCBmYXZvcml0ZXNbaV0pO1xuICAgICAgICAgIGlmKHJlcy5pZCA9PT0gZmF2b3JpdGVzW2ldKXtcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVGYXZlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLmJ1c2luZXNzZXMucHVzaChyZXMpO1xuICAgICAgfSkgICAgXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVyciBpbiBidXNpbmVzc0N0cmw6IFwiLCBlcnIpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICAvL2FkZCB0byB1c2VyIGZhdm9yaXRlc1xuICAgICRzY29wZS5mYXZvcml0ZSA9IChpbmRleCk9PntcbiAgICAgICRzY29wZS50b2dnbGVGYXZlID0gISRzY29wZS50b2dnbGVGYXZlO1xuICAgICAgY29uc29sZS5sb2coXCIkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF0uaWRcIiwgJHNjb3BlLmJ1c2luZXNzZXNbaW5kZXhdLmlkKVxuICAgICAgVXNlci5hZGRGYXZvcml0ZVRvVXNlciggUHJvZmlsZS5faWQsICRzY29wZS5idXNpbmVzc2VzW2luZGV4XS5pZClcbiAgICAgIC50aGVuKEJ1c2luZXNzLmFkZEZhdm9yaXRlKCRzY29wZS5idXNpbmVzc2VzW2luZGV4XSwgUHJvZmlsZS5faWQpKVxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlczpcIiAsIHJlcyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnIgaW4gYnVzaW5lc3NDdHJsOiBcIiwgZXJyKTtcbiAgICAgIH0pICAgIFxuICAgICAgY29uc29sZS5sb2coXCIkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF06XCIsICRzY29wZS5idXNpbmVzc2VzW2luZGV4XS5pZCk7XG4gICAgICAvKiAgICAgXG4gICAgICAudGhlbihyZXMgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVzOlwiICwgcmVzKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVyciBpbiBidXNpbmVzc0N0cmw6IFwiLCBlcnIpO1xuICAgICAgfSkqL1xuICAgIH1cblxuICAgICRzY29wZS51bkZhdm9yaXRlID0gKGluZGV4KT0+e1xuICAgICAgJHNjb3BlLnRvZ2dsZUZhdmUgPSAhJHNjb3BlLnRvZ2dsZUZhdmU7XG4gICAgICBjb25zb2xlLmxvZyhcIiRzY29wZS5idXNpbmVzc2VzW2luZGV4XS5pZFwiLCAkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF0uaWQpXG4gICAgICBVc2VyLnJlbW92ZUZhdm9yaXRlZnJvbVVzZXIoIFByb2ZpbGUuX2lkLCAkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF0uaWQpXG4gICAgICAvLy50aGVuKEJ1c2luZXNzLnJlbW92ZUZhdm9yaXRlKCRzY29wZS5idXNpbmVzc2VzW2luZGV4XSwgUHJvZmlsZS5faWQpKVxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlczpcIiAsIHJlcyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnIgaW4gYnVzaW5lc3NDdHJsOiBcIiwgZXJyKTtcbiAgICAgIH0pICAgIFxuICAgICAgY29uc29sZS5sb2coXCIkc2NvcGUuYnVzaW5lc3Nlc1tpbmRleF06XCIsICRzY29wZS5idXNpbmVzc2VzW2luZGV4XS5pZCk7XG4gICAgfVxuXG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmxldCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2ltYWdlQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXBsb2FkLCBQcm9maWxlLCAkcm9vdFNjb3BlKSB7XG4gIGNvbnNvbGUubG9nKFwiaW1hZ2UgY3RybFwiKTtcblxuXG4gICRyb290U2NvcGUuY3VycmVudFVzZXIgPSBQcm9maWxlO1xuXG4gICRzY29wZS5zdWJtaXQgPSAoKSA9PntcbiAgICBjb25zb2xlLmxvZygnc3VibWl0Jyk7XG4gICAgY29uc29sZS5sb2coJyRzY29wZS5maWxlOicsICRzY29wZS5maWxlKTtcbiAgICBcbiAgICBVcGxvYWQudXBsb2FkKHtcbiAgICAgIHVybDogJy9hcGkvaW1hZ2VzJyxcbiAgICAgIGRhdGE6IHtwaG90bzogJHNjb3BlLmZpbGUsIHVzZXI6ICRyb290U2NvcGUuY3VycmVudFVzZXIuX2lkfSAvL2FueXRoaW5nIGVsc2UgbGlrZSBuYW1lIHdpbGwgZW5kIHVwIGluIHJlcS5ib2R5XG4gICAgfSlcbiAgICAudGhlbihyZXMgPT57XG4gICAgICBjb25zb2xlLmxvZygncmVzOiAnLCByZXMpO1xuICAgICAgJHNjb3BlLnNhdmVkSW1hZ2UgPSByZXMuZGF0YTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnIgPT57XG4gICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKVxuICAgIH0pXG4gIH07XG5cbn0pO1xuXG4gIC8qJHNjb3BlLmNydWRzID0gW107XG5cbiAgQ3J1ZC5nZXRBbGwoKVxuICAudGhlbihyZXMgPT57XG4gICAgJHNjb3BlLmNydWRzID0gcmVzLmRhdGE7XG4gICAgY29uc29sZS5sb2coXCIkc2NvcGUuY3J1ZHM6XCIsICRzY29wZS5jcnVkcyk7XG4gIH0pXG4gIC5jYXRjaChlcnIgPT57XG4gICAgY29uc29sZS5sb2coXCJlcnI6IFwiLCBlcnIpO1xuICB9KVxuXG4gICRzY29wZS5hZGRDcnVkID0gKCkgPT57XG4gICAgQ3J1ZC5hZGRDcnVkKCRzY29wZS5uZXdJdGVtKVxuICAgIC50aGVuKGNydWQgPT57XG4gICAgICAkc2NvcGUuY3J1ZHMucHVzaChjcnVkKTtcbiAgICAgICRzY29wZS5uZXdJdGVtID0ge307XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyPT57XG4gICAgICBjb25zb2xlLmxvZyhcImVycm9yOiBcIiwgZXJyICk7XG4gICAgfSk7XG4gIH1cblxuXG4gICRzY29wZS5kZWxldGVDcnVkID0gKGluZCwgY3J1ZCkgPT57XG4gICAgY29uc29sZS5sb2coXCJjcnVkOlwiLCBjcnVkKVxuICAgIENydWQuZGVsZXRlQ3J1ZChjcnVkLl9pZClcbiAgICAudGhlbihjcnVkID0+IHtcbiAgICAgICRzY29wZS5jcnVkcy5zcGxpY2UoaW5kLDEpO1xuICAgIH0pXG4gICAgLmNhdGNoKGVycj0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnJvcjogXCIsIGVyciApO1xuICAgIH0pO1xuICB9XG5cbiAgJHNjb3BlLnNob3dVcGRhdGVGb3JtID0gKGluZGV4LCBjcnVkKSA9PntcbiAgICBjb25zb2xlLmxvZyhcImluZGV4OiBcIiwgaW5kZXgpO1xuICAgIGNvbnNvbGUubG9nKFwiY3J1ZDogXCIsIGNydWQpO1xuICAgICRzY29wZS5zaG93VXBkYXRlID10cnVlO1xuICAgICRzY29wZS51cGRhdGVJdGVtID0gY3J1ZDtcbiAgICAkc2NvcGUudXBkYXRlSW5kZXggPSBpbmRleDtcbiAgfVxuXG4gICRzY29wZS51cGRhdGVDcnVkPSAoKSA9PntcbiAgICAkc2NvcGUuc2hvd1VwZGF0ZSA9ZmFsc2U7XG4gICAgQ3J1ZC51cGRhdGVDcnVkKCRzY29wZS51cGRhdGVJdGVtLl9pZCwgJHNjb3BlLnVwZGF0ZUl0ZW0pXG4gICAgLnRoZW4oY3J1ZCA9PntcbiAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlIGFwdDpcIiAsICRzY29wZS51cGRhdGVJdGVtLl9pZCwgXCIgLCBcIiAsICRzY29wZS51cGRhdGVJdGVtKTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnI9PntcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3I6IFwiLCBlcnIgKTtcbiAgICB9KTtcbiAgfVxuKi9cblxuIiwiXG4ndXNlIHN0cmljdCc7XG5cbmxldCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkYXV0aCwgJHJvb3RTY29wZSkge1xuICBjb25zb2xlLmxvZygnbG9naW5DdHJsIScpO1xuXG4gICRzY29wZS5sb2dpbiA9ICgpID0+IHtcbiAgICAgICRhdXRoLmxvZ2luKCRzY29wZS51c2VyKVxuICAgICAgLnRoZW4ocmVzID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlczogXCIsIHJlcyk7XG4gICAgICAgIC8vJHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHJlcy5kYXRhO1xuICAgICAgICAkc3RhdGUuZ28oJ3Byb2ZpbGUnKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKTtcbiAgICAgIH0pXG4gICAgfTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxubGV0IGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuY29udHJvbGxlcignbWFpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgsICRyb290U2NvcGUpIHtcbiAgY29uc29sZS5sb2coJ21haW5DdHJsIScpO1xuXG4gICRyb290U2NvcGUuY3VycmVudFVzZXI7XG5cbiAgJHNjb3BlLmlzQXV0aGVudGljYXRlZCA9ICgpID0+ICRhdXRoLmlzQXV0aGVudGljYXRlZCgpO1xuXG4gICRzY29wZS5sb2dvdXQgPSAoKSA9PiB7XG4gICAgJGF1dGgubG9nb3V0KCk7XG4gICAgJHN0YXRlLmdvKCdob21lJyk7XG4gIH07XG5cbiAgJHNjb3BlLmF1dGhlbnRpY2F0ZSA9IHByb3ZpZGVyID0+IHtcbiAgICAkYXV0aC5hdXRoZW50aWNhdGUocHJvdmlkZXIpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuICAgICAgfSlcbiAgfTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgYXBwID0gYW5ndWxhci5tb2R1bGUoJ215QXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdwcm9maWxlQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUHJvZmlsZSwgUHJvZmlsZUJ5SUQsICRzdGF0ZSwgVXNlciwgJHJvb3RTY29wZSwgV2FsbFBvc3QpIHtcbiAgXG4gIGNvbnNvbGUubG9nKCdwcm9maWxlQ3RybCEnKTtcblxuICAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gUHJvZmlsZTtcblxuICAkc2NvcGUudXNlciA9IFByb2ZpbGVCeUlEIHx8IFByb2ZpbGU7XG5cbiAgV2FsbFBvc3QuZ2V0V2FsbFBvc3RzKCRzY29wZS51c2VyLl9pZClcbiAgICAudGhlbihyZXMgPT57XG4gICAgJHNjb3BlLnVzZXJXYWxscG9zdHMgPSByZXM7XG4gIH0pXG5cbiAgY29uc29sZS5sb2coXCJ1c2VyOlwiLCAkc2NvcGUudXNlciApO1xuICBjb25zb2xlLmxvZyhcImN1cnJ1c2VyOlwiLCAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyICk7XG5cbiAgJHNjb3BlLnNob3dkaXNwbGF5TmFtZUZvcm0gPSAoKSA9PntcbiAgICBjb25zb2xlLmxvZyhcInNob3cgZm9ybVwiKTtcbiAgICAkc2NvcGUuZGlzcGxheU5hbWVGb3JtID0gdHJ1ZTtcbiAgfVxuXG4gICRzY29wZS51cGRhdGVkaXNwbGF5TmFtZSA9ICgpID0+IHtcbiAgICAkc2NvcGUuZGlzcGxheU5hbWVGb3JtID0gZmFsc2U7XG4gICAgJHNjb3BlLnVzZXIuZGlzcGxheU5hbWUgPSAkc2NvcGUubmV3SXRlbS5kaXNwbGF5TmFtZTtcbiAgICBVc2VyLnVwZGF0ZVByb2ZpbGUoJHNjb3BlLnVzZXIuX2lkLCAkc2NvcGUubmV3SXRlbSlcbiAgICAgIC50aGVuKHByb2ZpbGUgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwicHJvZmlsZTpcIiwgcHJvZmlsZSk7XG4gICAgICAgICRzY29wZS5uZXdJdGVtLmRpc3BsYXlOYW1lID0gJyc7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgICB9KVxuICB9XG5cbiAgJHNjb3BlLmNhbmNlbGRpc3BsYXlOYW1lID0gKCkgPT57XG4gICAgJHNjb3BlLnVzZXJuYW1lRm9ybSA9IHRydWU7XG4gICAgJHNjb3BlLm5ld0l0ZW0uZGlzcGxheU5hbWUgPSAnJztcbiAgfVxuXG4vL3Bob3RvXG4gICRzY29wZS5zaG93UGljdHVyZUZvcm0gPSAoKSA9PntcbiAgICBjb25zb2xlLmxvZyhcInNob3cgZm9ybVwiKTtcbiAgICAkc2NvcGUucGhvdG9Gb3JtID0gdHJ1ZTtcbiAgfVxuXG4gICRzY29wZS51cGRhdGVQaWN0dXJlID0gKCkgPT4ge1xuICAgICRzY29wZS5waG90b0Zvcm0gPSBmYWxzZTtcbiAgICBjb25zb2xlLmxvZyhcIiRzdGF0ZS5jdXJyZW50OiBcIiwgJHN0YXRlLmN1cnJlbnQpO1xuICAgICRzY29wZS51c2VyLnByb2ZpbGVJbWFnZSA9ICRzY29wZS5uZXdJdGVtLnByb2ZpbGVJbWFnZTtcbiAgICBjb25zb2xlLmxvZyhcIiRzY29wZS5uZXdJdGVtOlwiLCAkc2NvcGUubmV3SXRlbSk7XG4gICAgVXNlci51cGRhdGVQcm9maWxlKCRzY29wZS51c2VyLl9pZCwgJHNjb3BlLm5ld0l0ZW0pXG4gICAgICAudGhlbihwcm9maWxlID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcInByb2ZpbGU6XCIsIHByb2ZpbGUpO1xuICAgICAgICAkc2NvcGUubmV3SXRlbS5wcm9maWxlSW1hZ2UgPSAnJztcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKTtcbiAgICAgIH0pXG4gIH1cblxuICAkc2NvcGUuY2FuY2VsUGhvdG9VcmwgPSAoKSA9PntcbiAgICAkc2NvcGUucGhvdG9Gb3JtID0gdHJ1ZTtcbiAgICAkc2NvcGUubmV3SXRlbS5waG90b1VybCA9ICcnO1xuICB9XG5cblxuICAkc2NvcGUuZGVsZXRlQWNjb3VudCA9ICh1c2VyKSA9PntcbiAgICAvL2FkZCBzd2FsXG4gICAgY29uc29sZS5sb2codXNlci5faWQpO1xuICAgIFVzZXIuZGVsZXRlQWNjb3VudCh1c2VyLl9pZClcbiAgICAgIC50aGVuKClcbiAgICAgIC5jYXRjaChlcnIgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyOiBcIiwgZXJyKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgICAkc2NvcGUuc3VibWl0TWVzc2FnZSA9ICgpID0+e1xuXG4gICAgdmFyIHBvc3RPYmogPSB7XG4gICAgICB0bzogJHNjb3BlLnVzZXIsXG4gICAgICBmcm9tOiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLl9pZCxcbiAgICAgIGZyb21OYW1lOiAkcm9vdFNjb3BlLmN1cnJlbnRVc2VyLmRpc3BsYXlOYW1lLFxuICAgICAgdGV4dDogJHNjb3BlLm5ld0l0ZW0udGV4dCxcbiAgICAgIGNyZWF0ZWRBdDogXCJhZGQgbW9tZW50XCJcbiAgICB9O1xuXG4gICAgY29uc29sZS5sb2coXCJwb3N0IG9iajpcIiwgcG9zdE9iaik7XG5cblxuICAgIFdhbGxQb3N0LmFkZFdhbGxQb3N0KHBvc3RPYmopXG4gICAgICAudGhlbih3YWxscG9zdCA9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJ3YWxscG9zdDpcIiAsIHdhbGxwb3N0KTtcbiAgICAgICAgVXNlci5hZGRXYWxsUG9zdFRvVXNlcihQcm9maWxlQnlJRC5faWQsIHdhbGxwb3N0Ll9pZCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oJHN0YXRlLmdvKCRzdGF0ZS4kY3VycmVudCwgbnVsbCwgeyByZWxvYWQ6IHRydWUgfSkpXG4gICAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgICBjb25zb2xlLmxvZyhcImVycjogXCIsIGVycik7XG4gICAgICB9KVxuICAgfTtcblxuXG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmxldCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkYXV0aCkge1xuICBjb25zb2xlLmxvZygncmVnaXN0ZXJDdHJsIScpO1xuXG4gICRzY29wZS5yZWdpc3RlciA9ICgpID0+IHtcbiAgICBpZigkc2NvcGUudXNlci5wYXNzd29yZCAhPT0gJHNjb3BlLnVzZXIucGFzc3dvcmQyKXtcbiAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkID0gbnVsbDtcbiAgICAgICRzY29wZS51c2VyLnBhc3N3b3JkMiA9IG51bGw7XG4gICAgICBhbGVydCgnUGFzc3dvcmRzIG11c3QgbWF0Y2ghJyk7XG4gICAgfWVsc2V7XG4gICAgICAkYXV0aC5zaWdudXAoJHNjb3BlLnVzZXIpXG4gICAgICAudGhlbihyZXMgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVzOiBcIiwgcmVzKTtcbiAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT57XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXJyOlwiLCBlcnIpO1xuICAgICAgfSlcbiAgICB9XG4gIH07XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmxldCBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3Nob3didXNpbmVzc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZVBhcmFtcywgQnVzaW5lc3MpIHtcbiAgY29uc29sZS5sb2coJ3Nob3didXNpbmVzc0N0cmwhJyk7XG5cbiAgbGV0IGJ1c2luZXNzSWQgPSAkc3RhdGVQYXJhbXM7XG4gIGNvbnNvbGUubG9nKFwiYnVzaW5lc3NJZFwiLCBidXNpbmVzc0lkLmJ1c2luZXNzSWQpO1xuXG4gIEJ1c2luZXNzLnNlYXJjaFllbHAoYnVzaW5lc3NJZC5idXNpbmVzc0lkKVxuICAudGhlbihyZXMgPT57XG4gICAgY29uc29sZS5sb2coXCJyZXM6XCIgLCByZXMpO1xuICAgICRzY29wZS5idXNpbmVzcyA9IHJlcztcbiAgfSkgICAgXG4gIC5jYXRjaChlcnIgPT57XG4gICAgY29uc29sZS5sb2coXCJlcnIgaW4gYnVzaW5lc3NDdHJsOiBcIiwgZXJyKTtcbiAgfSlcblxufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3VzZXJzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJCRzdGF0ZSwgJHN0YXRlLCBVc2VyKSB7XG4gIGNvbnNvbGUubG9nKCd1c2Vyc0N0cmwhJyk7XG5cbiAgdmFyIHVzZXJQcm9taXNlID0gVXNlci5nZXRBbGwoKTtcbiAgY29uc29sZS5sb2coXCJ1c2VyUHJvbWlzZTpcIiwgdXNlclByb21pc2UpO1xuICB1c2VyUHJvbWlzZS50aGVuKFxuICAgIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5kYXRhKTtcbiAgICAgICAkc2NvcGUudXNlckZlZWQgPSByZXN1bHQuZGF0YTtcbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuc2VydmljZSgnQnVzaW5lc3MnLCBmdW5jdGlvbigkaHR0cCwgJHEpe1xuXG4gIHRoaXMuc2VhcmNoWWVscCA9IChzZWFyY2gpID0+e1xuICAgIGNvbnNvbGUubG9nKFwic2VhcmNoOiBcIiwgc2VhcmNoKTtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KGAvYXBpL2J1c2luZXNzZXMveWVscC8ke3NlYXJjaH1gKVxuICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlcy5kYXRhIGluIHNlcnZpY2VzOlwiLCByZXMuZGF0YSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVzIGluIHNlcnZpY2VzOlwiLCByZXMpO1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7ICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcbiAgICAgIH0pXG4gIH1cblxuICB0aGlzLmFkZEZhdm9yaXRlID0gKGJ1c2luZXNzT2JqLCB1c2VySWQpID0+e1xuICAgIGNvbnNvbGUubG9nKFwiYnVzaW5lc3NPYmo6XCIsIGJ1c2luZXNzT2JqKTtcbiAgICByZXR1cm4gJGh0dHAucG9zdChgL2FwaS9idXNpbmVzc2VzLyR7dXNlcklkfWAsIGJ1c2luZXNzT2JqKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVzIGxuIDI0IGJ1c2luZXNzIHNlcnZpY2VzOlwiLCByZXMpO1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZShyZXMpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4geyAgIFxuICAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgICB9KVxuICAgIH07XG59KTtcblxuLy9kbyBmaW5kLCBpZiBub3QgaW4gZGIgdGhlbiBhZGQsIGlmIGluIGRiIGFkZCB1c2VyIHRvIGZhdm9yaXRlZCIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuc2VydmljZSgnaW1hZ2UnLCBmdW5jdGlvbigkaHR0cCwgJHEpe1xuXG4gIHRoaXMuZ2V0QWxsID0gKCkgPT57XG4gICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9jcnVkcycpO1xuICB9XG5cbiAgdGhpcy5nZXRCeUlkID0gaWQgPT57XG4gICAgcmV0dXJuICRodHRwLmdldChgL2FwaS9jcnVkcy8ke2lkfWApO1xuICB9XG5cbiAgdGhpcy5hZGRDcnVkPSAoY3J1ZCkgPT57XG4gICAgcmV0dXJuICRodHRwLnBvc3QoYC9hcGkvY3J1ZHNgLCBjcnVkKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4geyAgIFxuICAgICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgICB9KVxuICAgIH07XG5cbiAgdGhpcy5kZWxldGVDcnVkID0gKGlkKSA9PntcbiAgICByZXR1cm4gJGh0dHAuZGVsZXRlKGAvYXBpL2NydWRzLyR7aWR9YClcbiAgICAgIC50aGVuKCAoKSA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7ICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcbiAgICAgIH0pXG4gICAgfTtcblxuICB0aGlzLnVwZGF0ZUNydWQgPSAoaWQsIGNydWQpID0+e1xuICAgICAgcmV0dXJuICRodHRwLnB1dChgL2FwaS9jcnVkcy8ke2lkfWAsIGNydWQpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZShjcnVkKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHsgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuICAgICAgfSlcbiAgICB9O1xuXG59KTtcblxuLy9pbiByZXNpZGVudHMgUmVzaWRlbnQuZ2V0QWxsKClcbi8vICAgICAgICAgICAgICAgIC50aGVuKHJlc2lkZW50cyA9Pnt9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuc2VydmljZSgnVXNlcicsIGZ1bmN0aW9uKCRodHRwLCAkcSkge1xuXG4gIHRoaXMucHJvZmlsZSA9ICgpID0+IHtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzL3Byb2ZpbGUnKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgICAgfSk7XG4gIH07XG5cbiAgdGhpcy5nZXRQcm9maWxlID0gKGlkKSA9PntcbiAgICAgcmV0dXJuICRodHRwLmdldChgL2FwaS91c2Vycy9wcm9maWxlLyR7aWR9YClcbiAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmdldEFsbCA9ICgpID0+e1xuICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKTtcbiAgfVxuXG4gIHRoaXMudXBkYXRlUHJvZmlsZSA9IChpZCwgcHJvZmlsZU9iaikgPT57XG4gICAgY29uc29sZS5sb2coXCJoZXJlXCIpO1xuICAgIGNvbnNvbGUubG9nKGlkICwgXCIgXCIgLHByb2ZpbGVPYmopO1xuICAgIHJldHVybiAkaHR0cC5wdXQoYC9hcGkvdXNlcnMvcHJvZmlsZS8ke2lkfWAsICBwcm9maWxlT2JqKVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiAkcS5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goZXJyID0+e1xuICAgICAgY29uc29sZS5sb2coXCJlcnI6XCIsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICB0aGlzLmRlbGV0ZUFjY291bnQgPSAoaWQpID0+e1xuICAgIHJldHVybiAkaHR0cC5kZWxldGUoYC9hcGkvdXNlcnMvcHJvZmlsZS8ke2lkfWApXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUoKTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnIgPT57XG4gICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRoaXMuYWRkRmF2b3JpdGVUb1VzZXIgPSAoaWQsIHllbHBJZCkgPT57XG4gICAgLy9jb25zb2xlLmxvZyhcImFkZEZhdm9yaXRlVG9Vc2VyXCIsIFwiaWQ6XCIsIGlkLCBcInllbHBJZFwiLCB5ZWxwSWQpXG4gICAgcmV0dXJuICRodHRwLnB1dChgL2FwaS91c2Vycy9wcm9maWxlLyR7aWR9L2FkZC8ke3llbHBJZH1gKVxuICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVzIGxuIDUzOlwiLCByZXMpO1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PntcbiAgICAgIGNvbnNvbGUubG9nKFwiZXJyOlwiLCBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgdGhpcy5yZW1vdmVGYXZvcml0ZWZyb21Vc2VyID0gKGlkLCB5ZWxwSWQpID0+e1xuICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlIEZhdm9yaXRlXCIsIFwiaWQ6XCIsIGlkLCBcInllbHBJZFwiLCB5ZWxwSWQpXG4gICAgcmV0dXJuICRodHRwLnB1dChgL2FwaS91c2Vycy9wcm9maWxlLyR7aWR9L3JlbW92ZS8ke3llbHBJZH1gKVxuICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlcyBsbiA1MzpcIiwgcmVzKTtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUoKTtcbiAgICB9KVxuICAgIC5jYXRjaChlcnIgPT57XG4gICAgICBjb25zb2xlLmxvZyhcImVycjpcIiwgZXJyKTtcbiAgICB9KTtcbiAgfVxuIFxuXG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdteUFwcCcpO1xuXG5hcHAuc2VydmljZSgnV2FsbFBvc3QnLCBmdW5jdGlvbigkaHR0cCwgJHEpIHtcblxuICAgIHRoaXMuYWRkV2FsbFBvc3Q9ICh3YWxscG9zdCkgPT57XG4gICAgY29uc29sZS5sb2coXCJpbiBhZGQgd2FsbHBvc3Q6IFwiLCB3YWxscG9zdCk7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoYC9hcGkvd2FsbHBvc3RzYCwgd2FsbHBvc3QpXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICByZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7ICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcbiAgICAgIH0pXG4gICAgfTtcblxuXG4gICAgdGhpcy5nZXRXYWxsUG9zdHMgPSAodXNlcklkKSA9PntcbiAgICByZXR1cm4gJGh0dHAuZ2V0KGAvYXBpL3dhbGxwb3N0cy8ke3VzZXJJZH1gKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnI9PntcbiAgICAgICAgY29uc29sZS5sb2coXCJlcnI6IFwiLCBlcnIpO1xuICAgICAgfSk7XG4gIH07XG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
